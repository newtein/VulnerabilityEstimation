import csv
import numpy as np
import sys
import oval_parse as op


# config = {
# 	"apiKey": "AIzaSyDMbpFGyLizHQ11Su5OnGJ_e4rKHR3mRkY",
# 	"authDomain": "sal1-5a1a3.firebaseapp.com",
# 	"databaseURL": "https://sal1-5a1a3.firebaseio.com",
# 	"projectId": "sal1-5a1a3",
# 	"storageBucket": "",
# 	"messagingSenderId": "559686746977"
# 	}

# firebase = pyrebase.initialize_app(config)

def parse_nessus(fname):

	f=open(fname,"r")
	reader=csv.reader(f)
	data={}
	fool=0
	ipv4=0
	final_mean=[]
	cveid={}
	next(f)
	for l in reader:
		if l[3]!="None":
			key=l[1]
			if key!="":
				if key not in cveid:
					t_output=op.get_NVD_data(key)
					if t_output[0]!=None and t_output[1]!=None:
						cveid[key]=t_output
					if None not in t_output:
						final_mean.append(t_output[1])
						
	return cveid,final_mean

def nessus_parser(fname):

	# print("** Time should be exact copy-paste from file to maintain same format**")
	# stime=input("Copy/Paste start time")
	# etime=input("Copy/Paste end time")
	cveid,final_mean=parse_nessus(fname)
	mean=np.mean(final_mean)

	# Write data to file
	weighted_mean=op.writeDataToFile(fname,cveid)
	print('Weighted Mean',weighted_mean,"Mean",mean)

	return mean,weighted_mean,cveid
		
		
